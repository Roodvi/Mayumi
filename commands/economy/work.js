const { SlashCommandBuilder } = require('discord.js');
const db = require('../../db.js');

module.exports = {
    category: 'economy',
    data: new SlashCommandBuilder()
        .setName('work')
        .setDescription('–í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–Ω–∏-—Ä–∞–±–æ—Ç—É –∏ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –¥–µ–Ω—å–≥–∏'),
    async execute(interaction) {
        await interaction.deferReply();
        const userId = interaction.user.id;
        const guildId = interaction.guild.id;

        const [rows] = await db.query('SELECT work_last, balance FROM users WHERE user_id = ? AND guild_id = ?', [userId, guildId]);
        if (rows.length === 0) {
            return interaction.editReply('–£ –≤–∞—Å –µ—â—ë –Ω–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è.');
        }

        const now = Date.now();
        const lastWork = rows[0].work_last || 0;
        const hourMs = 3600000; // 1 —á–∞—Å

        if (now - lastWork < hourMs) {
            const remaining = Math.ceil((hourMs - (now - lastWork)) / 60000);
            return interaction.editReply(`–†–∞–±–æ—Ç–∞ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! –ü–æ–¥–æ–∂–¥–∏—Ç–µ –µ—â—ë ${remaining} –º–∏–Ω.`);
        }

        const minReward = 200;
        const maxReward = 800;
        const reward = Math.floor(Math.random() * (maxReward - minReward + 1)) + minReward;

        const jobs = [
            '–≤—ã–≥—É–ª—è–ª–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Å–æ–±–∞–∫—É –≤ –ø–∞—Ä–∫–µ',
            '–ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª–∏ –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —É–∂–∏–Ω',
            '–Ω–∞—Ä–∏—Å–æ–≤–∞–ª–∏ –∫–∞—Ä—Ç–∏–Ω—É –º–∞—Å–ª–æ–º',
            '—Å–ø–∞—Å–ª–∏ –ø—Ä–∏–Ω—Ü–µ—Å—Å—É –∏–∑ –∑–∞–º–∫–∞ –¥—Ä–∞–∫–æ–Ω–∞',
            '–Ω–∞—à–ª–∏ –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–π –∫–ª–∞–¥ –Ω–∞ –æ—Å—Ç—Ä–æ–≤–µ',
            '–ø–æ—Ñ–∏–∫—Å–∏–ª–∏ —Å–ª–æ–º–∞–Ω–Ω—ã–π –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ä–∞–±–ª—å',
            '–ø—Ä–æ–≤–µ–ª–∏ –∫–æ–Ω—Ü–µ—Ä—Ç –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –∫–ª—É–±–µ',
            '–≤—ã—Ä–∞—Å—Ç–∏–ª–∏ –º–∞–≥–∏—á–µ—Å–∫–∏–π —Å–∞–¥',
            '–ø–æ–π–º–∞–ª–∏ —Ä–µ–¥–∫—É—é —Ä—ã–±—É –≤ –æ–∫–µ–∞–Ω–µ',
            '—Å–æ–±—Ä–∞–ª–∏ –¥—Ä–µ–≤–Ω–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –≤ –¥–∂—É–Ω–≥–ª—è—Ö',
            '–ø–æ–±—ã–≤–∞–ª–∏ –±–∞—Ä–º–µ–Ω–æ–º –≤ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–º –±–∞—Ä–µ',
            '–ø–æ—Å—Ç—Ä–æ–∏–ª–∏ –∑–∞–º–æ–∫ –∏–∑ –ø–µ—Å–∫–∞ –Ω–∞ –ø–ª—è–∂–µ',
            '–ø–æ–ª–µ—Ç–∞–ª–∏ –Ω–∞ –º–µ—Ç–ª–µ –Ω–∞–¥ –ª–µ—Å–æ–º',
            '–ø–æ–º–æ–≥–ª–∏ –µ–¥–∏–Ω–æ—Ä–æ–≥—É –Ω–∞–π—Ç–∏ —Ä–æ–≥',
            '–∏—Å–ø–µ–∫–ª–∏ —Ç–æ—Ä—Ç –¥–ª—è –≤–µ–ª–∏–∫–∞–Ω–∞',
            '–ø—Ä–æ–∫–∞—Ç–∏–ª–∏—Å—å –Ω–∞ —Ä–æ–ª–∏–∫–∞—Ö –ø–æ —Ä–∞–¥—É–≥–µ',
            '–ø–æ—á–∏—Å—Ç–∏–ª–∏ –¥—Ä–µ–≤–Ω–∏–π —Ö—Ä–∞–º –æ—Ç –ø–∞—É—Ç–∏–Ω—ã',
            '—Å—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–ª–∏ —Å–µ–≤–µ—Ä–Ω–æ–µ —Å–∏—è–Ω–∏–µ',
            '–ø—Ä–æ–∫–∞—Ç–∏–ª–∏—Å—å –Ω–∞ –≤–æ–∑–¥—É—à–Ω–æ–º —à–∞—Ä–µ',
            '–Ω–∞—à–ª–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç –∑–µ–ª—å—è',
            '–ø–æ–∏–≥—Ä–∞–ª–∏ –≤ —à–∞—Ö–º–∞—Ç—ã —Å —Ä–æ–±–æ—Ç–æ–º',
            '–ø–æ–±—ã–≤–∞–ª–∏ –¥–µ—Ç–µ–∫—Ç–∏–≤–æ–º –∏ —Ä–∞—Å–∫—Ä—ã–ª–∏ –¥–µ–ª–æ',
            '—Å–æ–±—Ä–∞–ª–∏ –±—É–∫–µ—Ç –∏–∑ –∑–≤—ë–∑–¥–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤',
            '–ø—Ä–æ–∫–∞—Ç–∏–ª–∏—Å—å –Ω–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–µ –ø–æ –æ–±–ª–∞–∫–∞–º',
            '–ø–æ–º–æ–≥–ª–∏ —Ñ–µ–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –±–∞–ª',
            '–Ω–∞—à–ª–∏ –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–π –≥–æ—Ä–æ–¥ –ê—Ç–ª–∞–Ω—Ç–∏–¥—É',
            '–∏—Å–ø—ã—Ç–∞–ª–∏ –Ω–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç –∫–æ—Ñ–µ –∏–∑ –±—É–¥—É—â–µ–≥–æ',
            '–ø–æ–±—ã–≤–∞–ª–∏ –∞—Ä—Ö–µ–æ–ª–æ–≥–æ–º –Ω–∞ —Ä–∞—Å–∫–æ–ø–∫–∞—Ö',
            '—Å–æ–∑–¥–∞–ª–∏ —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ–º',
            '–ø—Ä–æ–∫–∞—Ç–∏–ª–∏—Å—å –Ω–∞ —Å–∞–Ω—è—Ö —Å –æ–ª–µ–Ω—è–º–∏'
        ];
        const randomJob = jobs[Math.floor(Math.random() * jobs.length)];

        await db.query('UPDATE users SET balance = balance + ?, work_last = ? WHERE user_id = ? AND guild_id = ?',
            [reward, now, userId, guildId]);

        await interaction.editReply(`üíº –í—ã ${randomJob} –∏ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏ **${reward}$**!`);
    },
};